<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Point code → Route ID & Sequence</title>
  <meta name="description" content="Voer een Point code in en toon in groot lettertype de bijhorende Route ID en Route sequence. CSV wordt lokaal geladen (upload of via URL). Werkt op GitHub Pages en Chrome op Android." />
  <style>
    :root { --bg:#0b1220; --fg:#e9f0ff; --muted:#9fb3d1; --card:#0f172a; --border:#1e293b; --ok:#67ff86; --err:#ff7a7a; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;background:var(--bg);color:var(--fg)}
    header{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    header h1{font-size:18px;margin:0}
    main{display:grid;grid-template-columns: 560px 1fr;gap:20px;padding:20px}
    @media (max-width:1100px){ main{grid-template-columns: 1fr} }
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden}
    .card h2{margin:0;padding:12px 14px;font-size:14px;color:var(--muted);border-bottom:1px solid var(--border)}
    .card .content{padding:14px}
    input[type=file], input[type=text], button{width:100%;margin-top:6px;margin-bottom:12px;padding:12px 14px;border-radius:10px;border:1px solid var(--border);background:#0b1220;color:var(--fg);font-size:16px}
    button.primary{background:#1d4ed8;border-color:#1e40af}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > * {flex:1 1 220px}
    .hint{color:var(--muted);font-size:13px;line-height:1.4}
    .ok{color:var(--ok)} .err{color:var(--err)}
    #out{background:#07101f;border:1px solid var(--border);border-radius:12px;padding:16px;min-height:120px}
    #big{font-size:42px;line-height:1.2;font-weight:800;letter-spacing:0.5px;margin:0}
    #sub{font-size:18px;color:var(--muted);margin:6px 0 0 0}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th, td{border-bottom:1px solid var(--border);padding:8px 6px;text-align:left;font-size:14px}
    .flex{display:flex;gap:10px;flex-wrap:wrap}
    .pill{display:inline-flex;gap:8px;align-items:center;background:#0a162c;border:1px solid var(--border);border-radius:999px;padding:8px 12px;font-size:13px}
  </style>
</head>
<body>
  <header>
    <h1>Point code → Route ID & Sequence</h1>
    <div class="pill">CSV lokaal • GitHub Pages • Android-vriendelijk</div>
  </header>

  <main>
    <section class="card">
      <h2>CSV laden</h2>
      <div class="content">
        <div class="row">
          <input type="file" id="csvfile" accept="*/*" />
          <button id="clearBtn">Leegmaken</button>
        </div>
        <div class="row">
          <input type="text" id="csvUrl" placeholder="of plak hier een CSV-URL (https://.../routes.csv)" />
          <button id="loadUrlBtn" class="primary">Laad CSV van URL</button>
        </div>
        <p class="hint">CSV verwacht kolommen: <code>Point code</code>, <code>Route ID</code>, <code>Route sequence</code> (andere kolommen worden genegeerd).<br>
        <b>Tip Android:</b> kies <i>Bestanden → Downloads</i>. We accepteren alle bestandstypes en controleren binnenin.</p>
        <div id="csvStatus" class="hint"></div>
      </div>
    </section>

    <section class="card">
      <h2>Zoeken op Point code</h2>
      <div class="content">
        <div class="flex">
          <input type="text" id="pointInput" placeholder="Vul Point code in (bijv. BE025833)" autocomplete="off" />
          <button id="searchBtn" class="primary">Zoek</button>
        </div>
        <div id="out">
          <p id="big">—</p>
          <p id="sub">Laad eerst een CSV en voer een Point code in.</p>
          <div id="tableWrap"></div>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Tips</h2>
      <div class="content hint">
        <ul>
          <li>Werkt volledig client-side (geen server). CSV blijft lokaal in je browser.</li>
          <li>Je kunt ook een CSV-URL gebruiken (moet publiek bereikbaar zijn via HTTPS, bv. in dezelfde GitHub Pages site).</li>
          <li>Zoek is niet hoofdlettergevoelig; spaties worden genegeerd.</li>
        </ul>
      </div>
    </section>
  </main>

<script src="https://unpkg.com/papaparse@5.3.2/papaparse.min.js"></script>
<script>
let db = [];
const csvStatus = document.getElementById('csvStatus');
const pointInput = document.getElementById('pointInput');
const big = document.getElementById('big');
const sub = document.getElementById('sub');
const tableWrap = document.getElementById('tableWrap');

function normalizePoint(s){
  return (s || '').toString().trim().toUpperCase().replace(/\s+/g, '');
}
function loadCsvFromFile(file){
  Papa.parse(file, {
    header:true, skipEmptyLines:true,
    complete:(res)=>{
      db = res.data;
      csvStatus.innerHTML = `<span class="ok">CSV geladen:</span> ${db.length} rijen`;
    },
    error:(err)=>{
      csvStatus.innerHTML = `<span class="err">CSV fout:</span> ${err}`;
    }
  });
}
function loadCsvFromUrl(url){
  if(!/^https?:\/\//i.test(url)){ 
    csvStatus.innerHTML = `<span class="err">Ongeldige URL</span>`; 
    return; 
  }
  Papa.parse(url, {
    download:true, header:true, skipEmptyLines:true,
    complete:(res)=>{
      db = res.data;
      csvStatus.innerHTML = `<span class="ok">CSV geladen vanaf URL:</span> ${db.length} rijen`;
    },
    error:(err)=>{
      csvStatus.innerHTML = `<span class="err">CSV fout (URL):</span> ${err}`;
    }
  });
}

function renderResults(rows){
  if(!rows || !rows.length){
    big.textContent = 'Geen resultaat';
    sub.textContent = 'Controleer je Point code of laad de juiste CSV.';
    tableWrap.innerHTML = '';
    return;
  }
  // Toon de eerste match groot
  const r = rows[0];
  const route = r['Route ID'] || '—';
  const seq = r['Route sequence'] || '—';
  big.textContent = `Route: ${route}   (seq ${seq})`;
  sub.textContent = rows.length > 1 ? `${rows.length} matches gevonden. Zie tabel hieronder.` : 'Exacte match.';

  // Bouw een kleine tabel met alle matches (indien meerdere)
  let html = '';
  if(rows.length > 1){
    html += '<table><thead><tr><th>Point code</th><th>Route ID</th><th>Route sequence</th></tr></thead><tbody>';
    for(const row of rows){
      html += `<tr><td>${row['Point code']||''}</td><td>${row['Route ID']||''}</td><td>${row['Route sequence']||''}</td></tr>`;
    }
    html += '</tbody></table>';
  }
  tableWrap.innerHTML = html;
}

function doSearch(){
  const q = normalizePoint(pointInput.value);
  if(!q){ renderResults([]); return; }
  const rows = db.filter(row => normalizePoint(row['Point code']) === q);
  renderResults(rows);
}

// UI events
document.getElementById('csvfile').addEventListener('change', (ev)=>{
  const f = ev.target.files[0];
  if(!f) return;
  loadCsvFromFile(f);
});
document.getElementById('clearBtn').addEventListener('click', ()=>{
  db = []; csvStatus.textContent = 'Leeg.'; renderResults([]);
});
document.getElementById('loadUrlBtn').addEventListener('click', ()=>{
  const url = document.getElementById('csvUrl').value.trim();
  loadCsvFromUrl(url);
});
document.getElementById('searchBtn').addEventListener('click', doSearch);
pointInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ doSearch(); }});

// Optioneel: probeer automatisch 'routes.csv' te laden uit dezelfde map (als die bestaat).
(async function tryAutoLoad(){
  try{
    const res = await fetch('routes.csv', { method:'HEAD' });
    if(res.ok){
      Papa.parse('routes.csv', {
        download:true, header:true, skipEmptyLines:true,
        complete:(r)=>{ db = r.data; csvStatus.textContent = `CSV automatisch geladen: ${db.length} rijen (routes.csv)`; },
        error:()=>{ /* negeren */ }
      });
    }
  }catch(_){ /* negeren */ }
})();
</script>
</body>
</html>
